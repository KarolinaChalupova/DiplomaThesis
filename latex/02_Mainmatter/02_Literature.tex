\chapter{Literature Review}
\label{chap:lit} 
	
 	What determines average stock returns? In other words, what is the cause that one stock earns 1\% yearly return on average, while another one earns 15\%? [TODO add chart]
 	Understanding the basis of stock prices is important for a number of reasons. First, fair stock valuation is vital for proper functioning of the stock market. The stock market, in turn, needs to function so as to maintain its roles: it enables firms to obtain financing for their investments, it allows investors to store their present wealth for the future and to share risk. [TODO elaborate] Moreover, as history has shown, incorrect stock price valuations can have severe ramifications. [TODO explain this more and give examples.]
 	
 	The question of what drives the stock returns is also a thrilling one to answer from several perspectives: that of an economist, of a statistician, of a machine learning engineer, and that of a finance practitioner.
 	An economist sees that stock returns reflect human decisions: putting a price tag on uncertain future payoffs reflects the trade-off between current and future consumption, human impatience and attitudes to risk \citep{cochrane2009asset} as well as human behavioral biases [TODO add reference]. She also sees that they speak of the complex web of relations between firms: as companies form relationships, they become exposed to similar risks, and their returns correlate. In the pattern of correlation and the structure of the net, one can see the determinants of macroeconomic stability and laws of shock transmission. [TODO add reference]. For the economist, studying the determinants of stock returns therefore is an opportunity to understand human behavior as well as the macroeconomic phenomena that emerge in the net of firms' relationships. 
 	The statistician is intrigued as well – she sees that the determinants of stock returns are notoriously over-studied and many of the published papers are just false positives \citep{harvey2016and}. She needs to control for all the gamut of published variables to separate the wheat from the chaff.
 	The machine learning engineer sees the problem as a prediction task: there is an infinite amount of data, the variables likely interact in complex ways, and are highly correlated. Machines have proven to excel in the task of predicting stock returns. They learn from financial data, model the interactions, and produce unparalleled returns predictions \citep{gu2020empirical}.
 	Finally, for the finance practitioner, understanding stock returns is closely related to the ability to predict them: to identify the future winners and losers, and sell and purchase them to make profit. As the machine-learning approaches are becoming the norm in the applied field, a need arises to understand the models on a deeper level – to interpret them, which brings us back to the economic underpinnings of stock returns.
 	
 	This thesis attempts to bring the economist, the statistician, the machine learning engineer and the finance practitioner together. I use machine learning models to predict stock returns and then interpret them to answer the economists' questions of what forces drive the stock returns. At the same time, the modeling approach naturally appeases the statistician's dissatisfaction with the false positive discoveries of prior research. Finally, the finance practitioner can use my model to select which stocks to trade, and then use the economic interpretation to learn what risks she is exposed to, and if she trades on this exposure, human biases, or market imperfections, and what are model's blinds spots and sources of performance. 
 	
 	The literature review proceeds as follows. First, I review the economic theory behind asset prices and common attitudes to modeling them. Second, I present the statistician's view: the multidimensional challenge faced in modeling stock returns \citep{cochrane2011presidential} and show what different approaches have been used to answer the challenge. Third, I present the machine learning approaches to asset pricing and how they are used to interpret the drivers of stock returns. Finally, I show how economics, statistics and machine learning, come together to answer the question of what drives the stock returns. 
 	
 	\section{Economist's Perspective}
 	
	 	Valuing a stock amounts to putting a price tag on a stream of future payoffs. The field concerned with doing just that is called asset pricing. Consider the following basic asset-pricing equation \citep{cochrane2009asset}:
	 	
	 	\begin{equation}
	 		p_t^i = E_t(m_{t+1} x_{t+1}^i ) \label{eq:pEmx}
	 	\end{equation}
	 	
	 	In words, the price of an asset $i$ at time $t$ ($p_t^i$) is proportional to the expected asset's payoff at time $t+1$ ($x_{t+1}^i$). However, since the payoff does not come now ($t$), but in future ($t+1$), we discount it to present by the factor $m_{t+1}$, called the \textit{stochastic discount factor}. The term stochastic stands to express the idea that $m_{t+1}$ is not known with certainty at time $t$. There is only one assumption made in order to write the equation: it can be shown that $m_{t+1}$ exists if and only if the \textit{law of one price} holds, that is, if two assets generate the exact same payoff in all possible states of nature have the same price. If this is the case, there is a discount factor such that the equation holds for all assets $i$ \citep{cochrane2009asset}.
	 	
	 	In the stock market, equation \ref{eq:pEmx} translates to:
	 	
	 	\begin{equation}
	 		1 = E_t(m_{t+1} R_{t+1}^i ) \label{eq:1EmR}
	 	\end{equation} 
	 	
	 	In words, an investor pays 1 dollar now to collect $R_{t+1}^i$ dollars in the future. The payoff is called gross return and is the sum of future price and dividend $R_{t+1}^i = p_{t+1}^i+ d_{t+1}^i$. 
	 	Using the definition of covariance, we can rearrange \ref{eq:1EmR} \citep{cochrane2009asset}:
	 	
	 	\begin{equation}
	 		1 = E_t(m_{t+1}) E_t(R_{t+1}^i) + Cov_t(m_{t+1},R_{t+1}^i) 
	 	\end{equation} 
 	
 		Defining the \textit{risk-free gross return} as $R_{t+1}^f=\frac{1}{E_t(m_{t+1})}$ and using it to further rearrange \citep{cochrane2009asset}:
 		
 		\begin{equation}
 			E_t(R_{t+1}^i) = \underbrace{R_{t+1}^f}_\text{risk-free return}  -  \underbrace{R_{t+1}^f Cov_t(m_{t+1},R_{t+1}^i)}_\text{risk adjustment} \label{eq:risk_adjustment}
 		\end{equation} 
 		
 		This important result shows that expected return if stock $i$ can be decomposed into risk-free return and risk adjustment. Note that the risk adjustment occurs if and only if returns are correlated to the discount factor, so \textit{idiosyncratic} risk, that is, uncorrelated with the discount factor, is uncompensated. Returns positively correlated to the discount factor should be low, and vice versa. So to explain average returns, we "only" need to explain the returns' correlation to the discount factor $m_{t+1}$. 
 		
 		Further rearranging \ref{eq:risk_adjustment} provides one more insight \citep{cochrane2009asset}. Multiply both sides by $Var_t(m_{t+1})/Var_t(m_{t+1})$ to obtain:
 		
 		\begin{align}
	 		E_t(R_{t+1}^i) 
	 		& = {R_{t+1}^f} + 
	 		\underbrace{
	 			\frac{Cov_t(m_{t+1},R_{t+1}^i)}{Var_t(m_{t+1})}
	 			}_\text{denote $\beta_{i,t}$} 
 			\cdot 
 			\underbrace{
 				\left(-\frac{Var_t(m_{t+1})}{E_t(m_{t+1})}\right)
 				}_\text{denote $\lambda_{t}$} \label{eq:factor_model} \\
 			& = \underbrace{{R_{t+1}^f}
 				}_\text{risk-free return} 
 				+ 
 				\underbrace{\beta_{i,t} \cdot \lambda_{t}
 				}_\text{risk adjustment} \label{eq:beta_reprezentation}
 		\end{align} 
 		
 		This equation is so-called \textit{beta-representation} of \ref{eq:1EmR}. It shows that the risk-adjustment, the premium a stock pays for being correlated with the discount factor, can be decomposed into $\beta_{i,t}$ and $\lambda_t$. $\lambda_t$ is the volatility of the discount factor and it is unrelated to properties of asset $i$. It can be interpreted as the price of risk. $\beta_{i,t}$ can be interpreted as the amount of the risk inherent in asset $i$. Empirically, it can be obtained as the coefficient from regressing asset $i$'s returns on the discount factor [TODO does this estimation introduce the assumption that beta is time-invariant?]: 
 		
 		\begin{equation}
 		R_{t+1}^i = a_i + \beta_{i}m_{t+1} + \epsilon_{i,t+1}
 		\end{equation} 
 		
 		Equations \ref{eq:risk_adjustment} and \ref{eq:beta_reprezentation} show that the discount factor is the key to explaining stock returns, as the latter is nothing but compensation for correlation with the former. Thus, specifying the discount factor is the only content of any asset-pricing model \cite{cochrane2009asset}. I review the consumption-based model, the CAPM, and multiple-factor models as special cases of these equations providing more intuition about what drives the discount factor. 
 			 	
	 	\subsection{Consumption-Based Model}
	 	
		 	The consumption-based model takes the additional assumption that the investor's preferences can be captured by her utility from consumption. The investor needs to decide how much to consume today and how much to save for tomorrow. First order conditions for this problem lead to the following specification of the discount factor \cite{cochrane2009asset}: 
		 	
		 	\begin{equation}
		 		m_{t+1} = \kappa \frac{u'(c_{t+1})}{u'(c_t)} \label{consumtion_based_model}
		 	\end{equation}
		 	
		 	where $u'(c_{t+1})$ denotes marginal utility from consumption. That is, the discount factor is the consumer's  marginal rate of substitution between consumption at time $t$ and $t+1$ and captures the willingness to trade consumption today for consumption tomorrow, where parameter $\kappa$ is the weight placed on future utility. This means that such an investor would demand a high return for stock that perform badly at times when she is unwilling to give up today's consumption, and a low return for stock that performs badly at times she is willing to give up today's consumption. 
		 	
		 	For simplification, one can assume constant relative risk aversion:
		 	
		 	\begin{equation}
		 		u(c_t) = \frac{c^{1-\gamma}-1}{1-\gamma}
		 	\end{equation}
		 	
		 	where $\gamma$ is a parameter positive for risk-averse individuals, and plug in to \ref{consumtion_based_model}: 
		 	
		 	\begin{equation}
		 	m_{t+1} = \kappa \left(\frac{c_{t+1}}{c_t}\right)^{-\gamma} 
		 	\end{equation}
		 	
		 	 That is, the discount factor is inversely proportionate to consumption growth. \ref{eq:risk_adjustment} says that assets with positive correlation with the discount factor should have lower returns, so it follows that assets highly correlated with consumption growth should earn high returns. This makes sense: the investor is assumed to care only about her marginal utility from consumption. Therefore, she demands a higher return for holding a stock that performs badly at times when her consumption decreases, and only a low return on insurance-like stocks that perform well during bad times.
		 	 
		 	 For the sake of completeness, we can rewrite this to the equivalent beta-representation using \ref{eq:beta_reprezentation} [TODO odvodit, overit, zpresnit notaci]: 
		 	 
		 	 \begin{align}
		 	 & E_t(R_{t+1}^i) = R_{t+1}^f + \beta_{i,t} \cdot \lambda_{t} \\
		 	 & \lambda_{t} = \gamma Var_t(\Delta c_{t+1}) \\
		 	 & R_{t+1}^i = \alpha_{i,t} + \beta_{i,t} \Delta c_{t+1} + \epsilon_{i,t+1}
		 	 \end{align}
		 	 
		 	  However, this model does not perform very well empirically \cite{cochrane1996cross}. There are two possible reasons, either, the aggregate consumption data are imperfectly measured, or the assumption that the investor maximizes the utility from consumption is off. This motivates tying the discount factor to other variables.
	 	
	 	\subsection{Capital Asset Pricing Model}
	 	
	 		The Capital Asset Pricing Model (CAPM) is the possibly most widely-known asset pricing model. It is the special case of the consumption-based model, making the additional assumption that the utility from consumption is logarithmic \citep{rubinstein1976valuation}:
	 		
	 		\begin{equation}
	 			u(c_t) = ln(c_t)
	 		\end{equation}
	 		
	 		Plugging this to \ref{consumtion_based_model}, one obtains 
	 		
	 		\begin{equation}
	 			m_{t+1} = \kappa \frac{c_t}{c_{t+j}}
	 		\end{equation}
	 		
	 		The CAPM operates with the concept of wealth portfolio, which comprises all world's wealth, inclusing real estate, metals, machinery or art. The price of this portfolio is (by \ref{eq:pEmx} and plugging in for the discount factor):  
	 		
	 		\begin{equation}
	 		p_t^W  = E_t \sum_{j=1}^{\infty} m_{t+j}c_{t+1} = \frac{\kappa}{1-\kappa}c_t
	 		\end{equation}
	 		
	 		and the return on wealth portfolio is therefore 
	 		
	 		\begin{equation}
	 		R_{t+1}^W  = \frac{p_{t+1}^W + c_{t+1}}{p_t^W} = \frac{1}{\kappa} \frac{c_{t+1}}{c_t} = \frac{1}{m_{t+1}}
	 		\end{equation}
	 		
	 		Thus, according to CAPM, the discount factor is the inverse of the return on the wealth portfolio. As \ref{eq:risk_adjustment} says that assets with positive correlation with the discount factor should earn low returns, if follows that assets positively correlated with the wealth portfolio should earn higher returns. Again, this makes sense: an investor who only cares about consumption demands a higher return for stocks that perform badly when other sources of wealth perform badly, and vice versa, she is willing to forgo some average return in exchange for good performance at times when all else fails. 
	 		
	 		Again, for completeness, we can rewrite this to the equivalent beta-representation using \ref{eq:beta_reprezentation} [TODO odvodit, overit, zpresnit notaci]: 
	 		
	 		\begin{align}
	 			& E(R_{t+1}^i) = \gamma + \beta_{i,t} \cdot \lambda_{t} \\
	 			& \lambda_{t} = E_t(R^W_{t+1}) - \gamma \\
	 			& R_{t+1}^i = \alpha_{i,t} + \beta_{i,t} R^W_{t+1} + \epsilon_{i,t+1}
	 		\end{align}  
	 		
	 		CAPM accomplishes the task of removing consumption data from empirical estimation of discount factor \citep{cochrane2009asset}, replacing them by return on wealth portfolio. However, this return is unobservable, so it is empirically often replaced by return on market portfolio of stocks. This may be problematic, as wealth comprises many more assets than just stocks, so the approximation is likely too crude \citep{roll1977critique}.  
	 		
	 		
	 	\subsection{Multi-factor Models}
	 		
	 		Multi-factor models are motivated by the notions that consumption growth and return on wealth portfolio do not proxy the discount factor empirically very well (in the consumption-based model and CAPM respectively), and they try to find other proxies for the discount factor $m_{t+1}$, factors $\vec{f}_{t+1}$. If we retain the idea that investor maximizes her utility from consumption, then the factors  should proxy the marginal utility growth \citep{cochrane2009asset}: 
	 		
	 		\begin{equation}
	 		m_{t+1} = \kappa \frac{u'(c_{t+1})}{u'(c_t)} \approx a+\vec{b}'\vec{f}_{t+1}
	 		\end{equation}
	 		
	 		The expression on the left-hand side can be interpreted as the rate at which the investor is willing to swap future for current consumption. [TODO verify that this understanding of mine is correct]. There are many variables that affect this rate. The current state of the economy, such as GDP growth, interest rate or investment, as well as new of the future states, forecasting either asset returns or macroeconomic variables. Many candidate factors can be defended on these grounds.   
	 		
	 		Multi-factor models explain returns as	 
	 	
	 	
			 	\begin{align}
			 		& E_t(R^i_{t+1}) = R^f_{t+1} + \boldsymbol\beta'_{i,t} \boldsymbol\lambda_{t} \\
			 		& R^i_{t+1} = \alpha_{i,t} + \boldsymbol\beta'_{i,t} \vec{f}_{t+1} + \epsilon_{i,t+1}
			 	\end{align}
			 
			 The \textit{factor loadings} $\boldsymbol\beta'_{i,t}$ of size $1\times K$ are exposures to risk factors $\vec{f}_{t+1}$ of size $K \times 1$, where $K$ is the number of risk factors. They represent the amount of risk inherent in asset $i$ due to its correlation to the corresponding risk factor. The $\boldsymbol\lambda_{t}$ of size $K \times 1$ are interpretable as the risk prices at time $t$ \citep{kelly2019characteristics}. (Note that the CAPM and consumption-based models are special cases of the multiple-factor models, where $K$, the number of factors, is 1.) 			
			 
			 First multi-factor model is \cite{fama1996multifactor} [TODO make sure the time indexation is right]:
			 
			 \begin{align}
			 	& E(R^i) = R^f + \boldsymbol\beta'_{i} \boldsymbol\lambda \\
			 	& R^i_{t+1} = \alpha_{i} + \boldsymbol\beta'_{i} \vec{f}_{t+1} + \epsilon_{i,t+1}
			 \end{align}
		 
		 	with factors  
			  		
				\begin{equation}
					\vec{f}_{t+1} = 
						\begin{pmatrix}
							R^M_{t+1}-R^f_{t+1} \\
							SMB_{t+1} \\
							HML_{t+1}				
						\end{pmatrix}
				\end{equation}
			
			and with factor prices 
			
			\begin{equation}
			  \boldsymbol \lambda =
				\begin{pmatrix}
					E(R^M})-R^f \\
					E(SMB) \\
					E(HML)				
				\end{pmatrix} 
			\end{equation}
			 
			The $R^M_{t+1}-R^f_{t+1}$ is the return on market portfolio above risk-free rate (as in CAPM), $SMB_{t+1}$ is the return on small-cap portfolio minus the return on big-cap portfolio, and $HML_{t+1}$ is the return on portfolio of stocks with small market values relative to book value, minus the return on portfolio of stocks with high market values relative to book value. Note that the risk prices $ \boldsymbol \lambda$ and $\boldsymbol\beta'_{i}$ are time-invariant. Explanations why $SMB$ and $HML$ should be correlated to the discount factor include that they proxy for financial distress \citep{fama1996multifactor}, \citep{heaton2000portfolio}} or that they forecast the future state of the economy \citep{liew2000can}. 		
			\cite{fama2015five} augment this three-factor model to five factors, adding $RMW$ and $CMA$, which are, respectively, the difference in returns on portfolios of firms with robust and weak profitability, and difference in returns on portfolios of firms with conservative and aggressive investment. 
			
	
	\section{Statistician's Perspective} 
		
		\epigraph{We argue that most claimed research findings in financial economics are likely false. }{\cite{harvey2016and}}
		
		Although theoretically the factor model is appealing, it is problematic to estimate it empirically. This is because the factors and betas are unobserved. 
		
		The first approach is to use prior knowledge of empirical behavior of average returns to pre-specify the factors, treat them as observable and then estimate $\beta_{t-1}$.
		
		A case in point is the standard \textit{portfolio-sorts procedure}. 
		1. Choose firm characteristic 
		2. Sort stocks into portfolios base on that characteristic \citep{fama1993common}
		3. See if differences in returns between these portfolios can be explained by a simpler factor model, such as CAPM or Fama-French-3 or Fama-French-5. If not, you have discovered an anomaly. 
		4. Publish.
		
		Using this method, academia has generated about 300 factors \citep{harvey2016and}, considering the top journals only. As the problem of average returns is so over-studied, 
	
	\section{Machine Learning Perspective}
	
		\epigraph{To adress [the multidimensional challenge] in the zoo of new variables, I suspect we will have to use different \textit{methods}.}{\cite{cochrane2011presidential}}
		
		An important implication of \ref{eq:asset_pricing} is that the factor loadings, in turn, are a possibly non-linear function of firm-level characteristics ($C_{t-1}$). 
		
		\begin{equation}
		\beta_{t-1}= g(C_{t-1})\label{eq:characteristics_as_proxies}
		\end{equation}
		
		In the words of \cite{fama1993common}: "(...) if assets are priced rationally, variables that are
		related to average returns, such as size and book-to-market equity, must proxy for
		sensitivity to common (shared and thus undiversiable) risk factors in returns." 	
		
		\cite{bryzgalova2019forest} generalize the portfolio-sorts using random trees.     
		
		The second strand of literature treats both $F_t$ and $\beta_{t-1}$ as unobservable, and estimates them both from the data, using the  relationship that firm-level characteristics are proxies of factor loadings (\ref{eq:characteristics_as_proxies}). For example, \cite{kelly2019characteristics} use characteristics as instrumental variables for factor loadings. Once loadings are instrumented, they use them to estimate the corresponding factors.
	
		\cite{gu2020empirical} 
    
	\section{Putting It All Together}
	

	
	   
	
	   
	



